<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<title>ﾄ斉ハg nh蘯ｭp</title>
</head>
<body>
	<div layout:fragment="content"
		class="d-flex justify-content-center align-items-center"
		style="min-height: 70vh;">
		<div class="card shadow-sm p-4" style="width: 400px;">
			<h2 class="text-center mb-4">ﾄ斉ハg nh蘯ｭp</h2>
			<form id="loginForm" method="post">
				<label>Email:</label> <input type="text" id="email" name="email"
					required /> <label>M蘯ｭt kh蘯ｩu:</label> <input type="password"
					id="passwd" name="passwd" required />

				<button type="submit">ﾄ斉ハg nh蘯ｭp</button>
			</form>
			<div id="errorBox" style="color: red; display: none;">Sai email
				ho蘯ｷc m蘯ｭt kh蘯ｩu!</div>


			<p class="mt-3 text-center">
				Chﾆｰa cﾃｳ tﾃi kho蘯｣n? <a th:href="@{/register}">ﾄ斉ハg kﾃｽ</a>
			</p>
		</div>
	</div>

	<script>
	document.getElementById("loginForm").addEventListener("submit", async function(e) {
	    e.preventDefault(); // 沐 ch蘯ｷn GET m蘯ｷc ﾄ黛ｻ杵h

	    const email = document.getElementById("email").value;
	    const passwd = document.getElementById("passwd").value;

	    try {
	        const res = await fetch("/auth/login", {
	            method: "POST",
	            headers: { "Content-Type": "application/x-www-form-urlencoded" },
	            body: new URLSearchParams({ email, passwd })
	        });

	        if (!res.ok) {
	            document.getElementById("errorBox").style.display = "block";
	            return;
	        }

	        const token = await res.text();   // server tr蘯｣ JWT
	        localStorage.setItem("jwt", token); // lﾆｰu token
	        window.location.href = "/home";   // chuy盻ハ hﾆｰ盻嬾g sau khi login
	    } catch (err) {
	        console.error(err);
	        document.getElementById("errorBox").style.display = "block";
	    }
	});

</script>
</body>
</html>
